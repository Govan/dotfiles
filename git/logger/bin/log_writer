#!/usr/bin/env ruby

datestamp = Time.new.strftime("%Y-%m-%d-%H")
log_file = File.join(File.dirname(File.dirname(__FILE__)), "logs/commits-#{datestamp}.html")

# Project name
# Single Line commit message
# When
# Commit Hash
#
# The long message


commit_message = `git log --pretty=format:"${PWD##*/} %n %s %n %cd %n %H %n %b" -1 HEAD`
parts = commit_message.split("\n")

project_name = parts.shift.strip
title = parts.shift.strip
committed_at = parts.shift.strip
hash = parts.shift.strip
comment = parts.collect {|l| l.strip }.join("\n")

File.open(log_file, "a") do |f|
  f.puts "<hr />"
  f.puts "<div class='evernote-styles-menu-h3' style='background:#D9FFC5;color:#242424;padding:5px;text-align: left;font-family:Avenir;'><span style='font-size: 15px;'><b>#{project_name}: #{title}</b></div>"
  f.puts "<span class='evernote-styles-menu-p' style='font-size:15px;font-family:Avenir;'><p>#{hash} @ #{committed_at}\n</span></p>"
  f.puts "\n<div class='evernote-styles-menu-code' style='font-size: 13px; padding: 9.5px; font-family: Monaco, Menlo, Consolas, monospace; color: rgb(51, 51, 51); border-radius: 4px; border: 1px solid #AAAAAA; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #EAEAEA'>"
  f.puts comment.gsub("\n", "<br />")
  f.puts "</div><br /><br />"
end
